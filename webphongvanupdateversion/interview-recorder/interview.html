<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interview Recorder</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px 0;
      font-family: 'Segoe UI', sans-serif;
    }
    .interview-card {
      background: white;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.12);
      padding: 35px;
      max-width: 760px;
      margin: 0 auto;
    }
    .progress { height: 10px; border-radius: 10px; background: #e0e0e0; margin-bottom: 30px; overflow: hidden; }
    .progress-bar { background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.6s ease; }
    .question-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 28px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(102,126,234,0.4);
    }
    #videoPreview {
      width: 100%; height: 420px; object-fit: cover; border-radius: 18px;
      background: #000; box-shadow: 0 15px 40px rgba(0,0,0,0.25);
    }
    .btn-rec {
      height: 58px; min-width: 200px; font-size: 1.15rem; font-weight: 600;
      border-radius: 16px; margin: 0 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      transition: all 0.3s;
    }
    .btn-rec:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .status { text-align: center; margin: 25px 0; font-size: 1.15rem; color: #444; font-weight: 500; }
    #uploadStatus { display:none; }

    /* Màn hình cảm ơn */
    .thankyou {
      text-align: center;
      padding: 80px 20px;
    }
    .thankyou h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #4facfe;
      margin-bottom: 20px;
    }
    .thankyou p {
      font-size: 1.2rem;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="interviewSection" class="interview-card">
    <div class="progress mb-4">
      <div id="progressBar" class="progress-bar" style="width:20%">1/5</div>
    </div>

    <div class="question-box">
      <div id="questionText">Câu hỏi sẽ hiển thị ở đây</div>
      <div>Question <span id="currentQ">1</span> of <span id="totalQ">5</span></div>
    </div>

    <div class="text-center mb-4">
      <video id="videoPreview" autoplay muted playsinline></video>
      <p id="status" class="status">Recording will start automatically</p>
    </div>

    <div class="text-center mb-4">
      <div id="timerDisplay" class="timer-circle">
        <span class="timer-text">--:--</span>
      </div>
    </div>

    <div class="text-center">
      <button id="stopBtn" class="btn btn-warning btn-rec d-none">Stop Recording</button>
      <button id="nextBtn" class="btn btn-success btn-rec d-none">Next →</button>
      <button id="retryBtn" class="btn btn-outline-secondary mt-3 d-none">Retry Upload</button>
    </div>

    <div id="uploadStatus"></div>
  </div>

  <!-- Màn hình cảm ơn (ẩn ban đầu) -->
  <div id="thankyouSection" class="thankyou d-none">
    <h1>Cảm ơn bạn đã tham gia phỏng vấn!</h1>
    <p>Chúng tôi sẽ liên hệ lại với bạn sau khi xem xét câu trả lời.</p>
  </div>

  <script src="js/recorder-v3.js"></script>

  <script>
    const stopBtn = document.getElementById('stopBtn');
    const nextBtn = document.getElementById('nextBtn');
    const retryBtn = document.getElementById('retryBtn');
    const statusText = document.getElementById('status');
    const uploadStatus = document.getElementById('uploadStatus');
    const currentQ = document.getElementById('currentQ');
    const totalQ = document.getElementById('totalQ');
    const interviewSection = document.getElementById('interviewSection');
    const thankyouSection = document.getElementById('thankyouSection');

    function updateNextButton() {
      nextBtn.textContent = (parseInt(currentQ.textContent) === parseInt(totalQ.textContent)) 
                            ? "Finish" 
                            : "Next →";
    }

    window.addEventListener('load', () => {
      statusText.textContent = "Recording...";
      if (typeof startRecording === "function") startRecording();
      stopBtn.classList.remove('d-none');
      uploadStatus.textContent = "";
      updateNextButton();
    });

    stopBtn.addEventListener('click', () => {
      stopBtn.classList.add('d-none');
      nextBtn.classList.remove('d-none');
      statusText.textContent = "Recording stopped. Ready for next question.";
      if (typeof stopRecording === "function") stopRecording();
      uploadStatus.textContent = "";
      updateNextButton();
    });

    nextBtn.addEventListener('click', () => {
      if (parseInt(currentQ.textContent) === parseInt(totalQ.textContent)) {
        // Hiện màn hình cảm ơn ngay tại chỗ
        interviewSection.classList.add('d-none');
        thankyouSection.classList.remove('d-none');
        return;
      }
      nextBtn.classList.add('d-none');
      statusText.textContent = "Preparing next question...";
      if (typeof nextQuestion === "function") nextQuestion();
      setTimeout(updateNextButton, 100);
    });

    retryBtn.addEventListener('click', () => {
      uploadStatus.textContent = "Retrying upload...";
      retryBtn.classList.add('d-none');
      if (typeof retryUpload === "function") retryUpload();
    });

    const observer = new MutationObserver(() => uploadStatus.textContent = "");
    observer.observe(uploadStatus, { childList: true, characterData: true, subtree: true });
  </script>
</body>
</html>